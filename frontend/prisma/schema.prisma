generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  role      String    @default("admin")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]

  @@map("users")
}

model Project {
  id          String        @id @default(cuid())
  title       String
  slug        String        @unique
  description String?
  content     String
  excerpt     String?
  featured    Boolean       @default(false)
  published   Boolean       @default(false)
  thumbnail   String?       // Image shown on overview/detail pages
  icon        String?       // Image shown on project list/cards
  tags        String[]
  technologies String[]
  liveUrl     String?
  githubUrl   String?
  startDate   DateTime?
  endDate     DateTime?
  publishedAt DateTime?
  order       Int           @default(0)
  titleFr       String?
  descriptionFr String?
  contentFr     String?
  excerptFr     String?
  authorId    String
  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  pages       ProjectPage[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([slug])
  @@index([published])
  @@index([featured])
  @@index([authorId])
  @@map("projects")
}

model ProjectPage {
  id          String   @id @default(cuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  slug        String
  title       String
  content     String
  order       Int      @default(0)
  titleFr     String?
  contentFr   String?
  isStartPage Boolean  @default(false)
  position    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  outgoingConnections PageConnection[] @relation("SourcePage")
  incomingConnections PageConnection[] @relation("TargetPage")

  @@unique([projectId, slug])
  @@index([projectId])
  @@index([isStartPage])
  @@map("project_pages")
}

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  nameFr    String?
  order     Int      @default(0)
  skills    Skill[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
  @@map("categories")
}

model Skill {
  id         String   @id @default(cuid())
  label      String
  icon       String
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([categoryId])
  @@map("skills")
}

model Hobby {
  id        String   @id @default(cuid())
  label     String
  labelFr   String?
  icon      String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
  @@map("hobbies")
}

model Testimonial {
  id        String   @id @default(cuid())
  name      String
  role      String?
  avatar    String?
  linkedin  String?
  message   String
  rating    Float
  status    String   @default("pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@map("testimonials")
}

model Setting {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt

  @@map("settings")
}

model PageConnection {
  id           String      @id @default(cuid())
  sourcePageId String
  sourcePage   ProjectPage @relation("SourcePage", fields: [sourcePageId], references: [id], onDelete: Cascade)
  targetPageId String
  targetPage   ProjectPage @relation("TargetPage", fields: [targetPageId], references: [id], onDelete: Cascade)
  label        String?
  createdAt    DateTime    @default(now())

  @@index([sourcePageId])
  @@index([targetPageId])
  @@map("page_connections")
}

enum ExperienceType {
  WORK
  EDUCATION
  CERTIFICATION
  VOLUNTEER
}

model Experience {
  id              String          @id @default(cuid())
  type            ExperienceType
  title           String
  titleFr         String?
  organization    String
  organizationFr  String?
  description     String?
  descriptionFr   String?
  location        String?
  locationFr      String?
  jobType         String?
  jobTypeFr       String?
  cause           String?
  causeFr         String?
  startDate       DateTime?
  endDate         DateTime?
  credentialId    String?
  credentialUrl   String?
  skills          String[]
  logo            String?
  order           Int             @default(0)
  media           ExperienceMedia[]
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([type])
  @@map("experiences")
}

model ExperienceMedia {
  id            String     @id @default(cuid())
  experienceId  String
  experience    Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)
  url           String
  caption       String?
  captionFr     String?
  order         Int        @default(0)
  createdAt     DateTime   @default(now())

  @@index([experienceId])
  @@map("experience_media")
}

model Server {
  id          String         @id @default(cuid())
  name        String
  type        String
  description String?
  icon        String?
  nodes       TopologyNode[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@map("servers")
}

model TopologyNode {
  id            String               @id @default(cuid())
  serverId      String
  server        Server               @relation(fields: [serverId], references: [id], onDelete: Cascade)
  containerId   String
  containerName String
  icon          String?
  positionX     Float                @default(0)
  positionY     Float                @default(0)
  visible            Boolean              @default(true)
  showLogs           Boolean              @default(true)
  order              Int                  @default(0)
  nodeType           String               @default("container")
  infrastructureType String?
  outgoing           TopologyConnection[] @relation("TopologySource")
  incoming      TopologyConnection[] @relation("TopologyTarget")
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt

  @@index([serverId])
  @@map("topology_nodes")
}

model TopologyConnection {
  id        String       @id @default(cuid())
  sourceId  String
  targetId  String
  source    TopologyNode @relation("TopologySource", fields: [sourceId], references: [id], onDelete: Cascade)
  target    TopologyNode @relation("TopologyTarget", fields: [targetId], references: [id], onDelete: Cascade)
  label     String?
  animated  Boolean      @default(true)
  createdAt DateTime     @default(now())

  @@index([sourceId])
  @@index([targetId])
  @@map("topology_connections")
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String
  message   String
  status    String   @default("unread")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@map("contact_messages")
}
